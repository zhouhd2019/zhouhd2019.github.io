---
layout:     post
title:      "Optimization for Smooth Paths"
subtitle:   "GameAIPro3 Chapter20"
date:       2021-03-10  14:53:00
author:     "zhouhd"
header-img: "img/about-bg.jpg"
catalog: true
tags:
    - GameAI
    - GameAIPro
    - GameAIPro3
    - GameProgramming
---

## CorridorMap路径
- CorridorMap和常见的导航网格不同，它用圆来覆盖可行走区域，圆之间存在重叠，只覆盖大部分可行走区域
- CorridorMap产生的路径基本由经过圆心的线段组成，比最短路径要长，但存在大量空间来进行路径平滑

## 路径平滑优化问题
- 优化问题包含两部分，能量(消耗)函数和能量最小化算法。路径越平滑且越短，能量则越小

#### 能量函数
- 能量函数第一部分是路径曲折程度，对每个点进行计算，和前后点组成两个向量相加(起始和结束点则加上角色朝向)，取结果向量的长度乘以该点权重，计算它平方的一半，作为该点的曲折程度。所有拐点曲折程度相加就是路径曲折程度
- 能量函数第二部分是路径总长度
- 能量函数第三部分判断拐点在不在CorridorMap上，不在则直接将能量设置为最大值来否定这个结果，由于CorridorMap由圆构成，因此判断比较快速
- 能量函数对于起始和结束点需要特殊处理，在第一部分计算曲折程度，需要将角色朝向作为其中一个向量加入计算
- 能量函数第一部分对每个点有一个权重，可以进行自定义，越大就越平滑，0就是最短路径。起点和终点的权重加大，可以减少起始和结束的原地转向

#### 优化算法
- 能量函数由三个相关的凸函数之和给出，但通过转化可以用成熟方法来计算，通过迭代得到接近最优的结果
- 整个流程为：CorridorMap得到一条路径，在路径上插入足够的点，迭代优化能量函数结果
