---
layout:     post
title:      "Predictive Animation Control Using Simulations and Fitted Models"
subtitle:   "GameAIPro3 Chapter16"
date:       2021-10-05  15:10:00
author:     "zhouhd"
header-img: "img/about-bg.jpg"
catalog: true
tags:
    - GameAI
    - GameAIPro
    - GameAIPro3
    - GameProgramming
---

本文讲讲述FF15如何用模拟和拟合模型来解决Steering和路径跟随的动画问题

### 困境
- 角色移动一帧常见更新流程包括：AI，Steering，动画，物理
- 动画一般仅依赖速度和目标朝向，但某几段动画可能和其它同类有不一样的加速度，甚至超过速度上下限
- 动画位移可能有些细节不符合应用场景，需要程序员手工定制
- 环境会限制动画位移
- 角色缩放和动画播放速率会运行时修改
- 常用的解决方法是动作图。FF15采用机器学习方法，对角色动作能力进行建模，统一解决所有问题

### 模拟与测量
- 最终目标是构建一个复杂的动作模型，Steering可以用这个模型来准确地控制角色
- 需要一个模拟方法，可以对动作的准确程度进行估计
- 模拟不需要跑AI和Steering，只需要根据情况播放动画并且评估它的结果，例如速度最大最小值
- 模拟时，角色需要跑一系列移动指令，对每个指令的过程进行采样和测量，一般要记录速度和旋转

### 位移准确度建模
- 模拟和测量结束后，需要进行建模来评估位移准确度
- 第一个需要测算的是速度范围，先根据角色给定速度范围，然后看看动画速度能否符合要求，这里只对那些向前直走的动画进行评估
- 接下来是停止移动的动画，需要测算它的初始速度和停止距离大比值
- 减速动画需要测算速度降低量和所需距离的比值
- Overshoot用于计算角色需要多少空间来转身，速度和角度差值对这个值影响较大
- 让角色保持一定速度，边转弯边向前移动，轨迹圆的半径就是转弯半径

### 运行时
- 通过模拟提取的动作参数用于辅助运行时的Steering
- 速度最大最小值用于限制可选速度范围，其它参数用于提高控制精度
- 减速函数可以给出减速时需要的距离
- 对于那些没有原地转身动作的角色，Overshoot可以让角色提前进行转弯
