---
layout:     post
title:      "Collision Avoidance for Preplanned Locomotion"
subtitle:   "GameAIPro Chapter22"
date:       2021-02-04  20:04:00
author:     "zhouhd"
header-img: "img/about-bg.jpg"
catalog: true
tags:
    - GameAI
    - GameAIPro
    - GameProgramming
---

## 运动和避让
- 传统移动系统，先决定角色轨迹，在这基础上决定动画。这样会导致动画不会完全匹配实际移动，引起滑步等问题
- 动画驱动运动ADL的方法，角色移动轨迹由动画决定，不会有滑步的问题。但移动的轨迹只能由现有动画来构成，而且要等上一个动画结束了才能发起下一个动画，导致延迟
- 杀手：赦免实现了一个基于ADL的预规划运动系统，每个角色沿着光滑的路径移动，路径先从寻路网格获得，然后分段处理成二次贝塞尔曲线，接下来就根据路径和动画，计算具体的运动过程

## 碰撞检测和碰撞解决
- 首先要决定碰撞检测的范围，检测时间长度(自行决定)乘以速度，再加上当前停下来的动画位移
- 两个简单的初步检测可以排除部分碰撞对象。一个是点积来判断碰撞对象是否在前方，只有在前方才有可能碰撞。另一个是判断碰撞对象是否在碰撞检测范围内，不在就暂时可以忽略
- 让对象沿着路径移动一小段，直到到达检测范围边界。每次移动，都进行一次碰撞检测，简单的圆形判断距离。如果发生碰撞就记录下碰撞相关数据，并开始碰撞解决
- 碰撞解决有两种，先进行简单的，修改对象速度(一般是降低)使得不再碰撞，如果都不可以，就直接停下，直到可以继续行走。但如果碰撞对象是不可移动的等等特殊情况，就不能简单解决
- 高级碰撞解决方案对路径进行了修改，根据碰撞信息，计算出两个点，一个是离开原有路径来避免碰撞的点，另一个回到原有路径。新增的避让路径要切成小段，进行新的检查，一个是检查是否在寻路网格内且寻路直线可达，另一个是检查会不会引起新的碰撞，能否通过减速解决
- 如果新避让路径会碰撞，那么可以修改碰撞对象的路径。如果没办法避免，就只能选择一条碰撞最小的路径
