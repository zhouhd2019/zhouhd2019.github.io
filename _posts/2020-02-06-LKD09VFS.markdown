---
layout:     post
title:      "LKD VFS"
subtitle:   "虚拟文件系统"
date:       2020-02-06 21:18:00
author:     "zhouhd"
header-img: "img/about-bg.jpg"
catalog: true
tags:
    - Linux
    - Linux Kernel
---

对应LKD3第13章虚拟文件系统。

- VFS有四个主要的对象类型：超级块，代表一个具体的已安装的文件系统；索引节点对象，代表一个具体文件；目录项对象，代表一个目录项，是路径的一个组成部分；文件对象，代表由进程打开的文件。
- 超级块用于存储特定文件系统的信息，通常对应于存放在磁盘特定扇区中的文件系统超级块或文件系统控制块。
- 索引节点对象包含了内核在操作文件或目录时需要的全部信息。
- VFS把目录当作文件对待，有对应的索引节点对象，但为了方便查找操作，VFS引入目录项的概念，每个dentry代表路径中的一部分。目录项没有对应的磁盘数据结构，不需要写回磁盘。
- 文件对象实际上没有对应的磁盘数据，所以struct file没有代表其对象是否需要写回磁盘的标志。文件对象通过f_dentry指向相关目录项对象，目录项会指向相关的索引节点，索引节点会记录文件是否为脏。
- 除了上面的基础对象，文件系统的其它数据有别的对象来表示。例如每种文件系统会对应有一个file_system_type，不管有多少个实例，都只有一个。而vfsmount表示一个安装文件系统的实例。
- 有三种数据结构将VFS和进程联系在一起：file_struct包含所有与单个进程相关的信息（如打开的文件及文件描述符）；fs_struct包含文件系统和进程相关信息，例如当前工作目录；namespace代表进程的命名空间，一般来说所有进程共用一个命名空间，clone()时使用CLONE_NEWS可以给进程另外的命名空间结构体。
