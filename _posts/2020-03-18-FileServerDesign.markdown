---
layout:     post
title:      "File Server Design"
subtitle:   "简单文件服务器设计"
date:       2020-03-18 23:59:00
author:     "zhouhd"
header-img: "img/about-bg.jpg"
catalog: true
tags:
    - server
---

如果要实现一个简单的文件服务器（网盘），想了想，大概有这么几点
- 客户端HTTP RESTFUL来进行交互，GET下载/POST上传/DELETE删除
- 服务器分两部分，数据处理层和存储层
- 数据处理层存放文件ID和存储层文件节点的对应关系，文件元信息也可以放这一层，这些信息可以放到Mongodb，这一层也用来处理客户端请求
- 存储层存放实际的文件，如果用数据库去做，那就简单了。如果要自己做，可以用块为单位存放文件，大文件单独一个块，多个小文件放到一个块。还要记录文件ID到(块ID,块偏移)等等信息之间的映射关系，同样的，这部分元信息可以放到Mongodb
- 存储层文件节点包含多个块，每个节点会有1到2个备份，备份方式可以参考mongodb的主从方式。如果觉得这样冗余太多，可以改为交叉的方式。例如双备份，机器1存放节点A和B，机器2存放BC，机器3存放AC，这样互相备份。
- 文件上传了以后就不能修改，只能删除重新上传。大文件或许可以支持修改。删除会产生空洞，所以需要记录下这些空洞，给后续使用。
